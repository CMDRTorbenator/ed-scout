<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>ED Scout {{ version }}</title>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

    <style>
        body {
            background-color:black;
            font: 20px Eurostile, sans-serif;
            text-transform: uppercase;
        }

        .system {
            margin-top: 1px;
            margin-bottom: 1px;
            padding-left: 10px;
            text-shadow: 0px 0px 3px;
            margin-left: 1px;
            margin-right: 1px;
        }
        .charted {
            color: #9f9f9f;
            background: #333333;
        }
        .uncharted {
            color: #EAA529;
            background: #370C03;
        }
        .highlighted {
            color: #370C03;
            background: #F5A804;
        }

        .current_location {
            border-style: dotted;
            border-color: #17EFF9;
            border-width: 1px;
        }
    </style>
</head>

<body>

    <div class="container highlighted">
        <hr>
    </div>
    <div id="location" class="container highlighted" data-currentSystem="">
        Location: Unknown
    </div>
    <div id="targetsys" class="container highlighted">
        FSD Target: Not Set
    </div>
    <div class="container highlighted">
        <hr>
    </div>
    <div id="navroute" class="container">
        <div class="row">
            <div class="col system highlighted text-center">Waiting for nav data...</div>
        </div>
    </div>
    <div class="container highlighted">
        <hr>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.js"></script>
    <script>



        (function init() {

            document.addEventListener('DOMContentLoaded', function() {
                var url = 'http://127.0.0.1:5001/GUI-is-still-open';
                fetch(url, { mode: 'no-cors'});
                setInterval(function(){ fetch(url, { mode: 'no-cors'});}, 5000);
            });

            var socket = io()
            var loggerElement = document.getElementById('navroute')
            const isFirstElemnth = loggerElement.childElementCount === 0

            function setCurrentSystem(status, systemId, systemName) {
                let loggerElement = document.getElementById('location')

            }

            function setTargetSystem(systemId) {

            }

            function startJumpTo(systemId, systemName) {

            }

            function postData(payload) {
                console.log(payload);
                //console.log(payload.data.type);
                if (payload.data.type == 'NewRoute')
                {
                    console.log('Clearing')
                    loggerElement.innerHTML = ''
                }
                else if (payload.data.type == 'JournalEntry')
                {
                    if (payload.data.event == "FSDTarget")
                    {
                        var loggerElement1 = document.getElementById('targetsys')
                        loggerElement1.innerHTML = "FSD Target: "+payload.data.Name
                        /*
                        <---------- todo;
                            lookup current 'data-currentSystem' and clear the highlighting of it.
                            set data-currentSystem for current location
                            If a matching system is in the DOM, highlight it instead.
                            Then we just need some clear means of indicating what is current vs targetted vs jumpnig systems
                            Sould also show how many jumps left
                        */
                    }
                    else if (payload.data.event == "Location")
                    {
                        var loggerElement1 = document.getElementById('location')
                        loggerElement1.innerHTML = "Location: "+payload.data.StarSystem
                    }
                    else if (payload.data.event == "StartJump") // When 3..2..1 starts
                    {
                        var loggerElement1 = document.getElementById('location')
                        loggerElement1.innerHTML = "Starting jump to: "+payload.data.StarSystem
                    }
                    else if (payload.data.event == "FSDJump") // When you drop out of hyperspace
                    {
                        var loggerElement1 = document.getElementById('location')
                        loggerElement1.innerHTML = "Location: "+payload.data.StarSystem
                    }
                }
                else
                {
                    var dataElement = document.createElement('div')
                    systemInfo = payload.data

                    var row = '<div class="row">'

                    if (systemInfo.charted == true)
                    {
                        row += '<div id="'+systemInfo.SystemAddress+'" class="col-1 system charted text-center">'+systemInfo.StarClass+'</div><div class="col system charted">'+systemInfo.StarSystem+'</div><div class="col-3 system charted text-center">'+systemInfo.estimatedValueMapped+'</div>'
                        console.log('CHARTED')
                    }
                    else
                    {
                        row += '<div id="'+systemInfo.SystemAddress+'" class="col-1 system uncharted text-center">'+systemInfo.StarClass+'</div><div class="col system uncharted">'+systemInfo.StarSystem+'</div>'
                    }
                    row += '</div>'

                    dataElement.innerHTML = row

                    loggerElement.appendChild(dataElement)
                    console.log(systemInfo.valuableBodies)
                    var body;
                    for (body of systemInfo.valuableBodies)
                    {
                        console.log(body)
                        var dataElement2 = document.createElement('div')
                        var row2 = '<div class="row">'
                        row2 += '<div class="col-1 system"></div><div class="col-1 system charted text-center">'+'P'+'</div><div class="col system charted">'+body.bodyName+'</div><div class="col-3 system charted text-center">'+body.valueMax+'</div>'
                        row2 += '</div>'
                        console.log('BODY')
                        dataElement2.innerHTML = row2
                        loggerElement.appendChild(dataElement2)
                    }
                }
            }

            /**
            var exampleData = [
                {'data': {'type': 'System', 'StarSystem': 'Sifeae EH-C c13-3', 'SystemAddress': 913385362290, 'StarPos': [2899.96875, 206.34375, 801.6875], 'StarClass': 'K', 'id': 55216390, 'id64': 913385362290, 'name': 'Sifeae EH-C c13-3', 'url': 'https://www.edsm.net/en/system/bodies/id/55216390/name/Sifeae+EH-C+c13-3', 'estimatedValue': 112130, 'estimatedValueMapped': 368117, 'valuableBodies': [{'bodyId': 226907740, 'bodyName': 'Sifeae EH-C c13-3 A 1', 'distance': 1250, 'valueMax': 365696}], 'charted': true}},
                {'data': {'type': 'System', 'StarSystem': 'Pro Eurl YJ-Q d5-18', 'SystemAddress': 629388954035, 'StarPos': [2035.6875, 381.59375, 739.6875], 'StarClass': 'F', 'id': 55108083, 'id64': 629388954035, 'name': 'Pro Eurl YJ-Q d5-18', 'url': 'https://www.edsm.net/en/system/bodies/id/55108083/name/Pro+Eurl+YJ-Q+d5-18', 'estimatedValue': 39863, 'estimatedValueMapped': 127197, 'valuableBodies': [], 'charted': true}},
                {'data': {'type': 'System', 'StarSystem': 'Pro Eurl DV-E c12-2', 'SystemAddress': 637098300266, 'StarPos': [2083.0, 374.71875, 748.09375], 'StarClass': 'K', 'charted': false}}]

            postData(exampleData[0])
            postData(exampleData[1])
            /**/

            socket.on('log', postData)



        })()
    </script>
</body>

</html>